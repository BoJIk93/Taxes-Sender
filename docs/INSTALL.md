# Установка Taxes Sender

Пошаговая установка на **Windows** и **Linux**.

---

## Общие требования

- **Node.js** версии **16** или выше.  
  Проверка: `node --version`
- Доступ в интернет для загрузки платежей (ЮKassa) и отправки чеков (ФНС).
- Учётные данные:
  - ЮKassa: **Shop ID** и **секретный ключ**
  - Личный кабинет самозанятого (Мой налог / ЛК НПД): **логин** и **пароль**

---

# Windows

## Вариант 1: Ручной запуск (без установки)

1. Установите Node.js с [nodejs.org](https://nodejs.org/) (LTS).
2. Скачайте или клонируйте проект, откройте папку в терминале (PowerShell или cmd).
3. Установите зависимости и запустите:
   ```bat
   npm install
   npm start
   ```
   Или просто дважды запустите **`start.bat`** (если Node.js уже в PATH).
4. Браузер откроется на `http://127.0.0.1:3847`. Если нет — откройте этот адрес вручную.
5. Остановка: закройте окно терминала или нажмите Ctrl+C. Либо запустите **`stop.bat`**.

### Портативная Node.js (без установки в систему)

- В папке установщика Windows есть скрипты для загрузки Node.js в подпапку `node/` (например, `install/windows/download-node.ps1`). После этого `start.bat` подхватывает `node\node.exe` и не требует глобальной установки Node.

---

## Вариант 2: Установщик (HTA)

1. Запустите **`install/windows/install.hta`** (двойной клик).
2. Следуйте шагам:
   - при необходимости скачивание/установка Node.js;
   - выбор папки приложения;
   - опционально: установка как службы Windows (автозапуск при старте системы) через NSSM.
3. После установки можно запускать приложение ярлыком или службой.

Служба Windows (NSSM) скачивается установщиком при выборе автозапуска. Логи службы при необходимости настраиваются (например, скрипт `install/windows/ensure-service-logs.ps1`).

---

## Порты и доступ

- По умолчанию приложение слушает порт **3847** на всех интерфейсах (`0.0.0.0`).
- Локально: **http://127.0.0.1:3847**
- Из локальной сети: **http://&lt;IP вашего ПК&gt;:3847**
- Если включите авторизацию в настройках — обязательно смените логин и пароль по умолчанию (`admin` / `admin`).

---

# Linux

## Вариант 1: Ручной запуск

1. Установите Node.js 16+ (через пакетный менеджер или [nodejs.org](https://nodejs.org/)):
   ```bash
   node --version   # должно быть v16+
   ```
2. Перейдите в папку проекта и установите зависимости:
   ```bash
   cd /путь/к/taxes-sender
   npm install
   ```
3. Запуск:
   ```bash
   node server/index.js
   ```
   Откройте в браузере: **http://127.0.0.1:3847** (или `http://IP_СЕРВЕРА:3847`).
4. Остановка: Ctrl+C в терминале или:
   ```bash
   pkill -f "server/index.js"
   ```

### Запуск в фоне с логами

```bash
nohup node server/index.js >> data/server.log 2>&1 &
tail -f data/server.log   # просмотр логов
```

---

## Вариант 2: Автозапуск при старте системы

1. Выполните установочный скрипт **с правами root**:
   ```bash
   sudo bash install/linux/install.sh
   ```
2. Скрипт:
   - проверит наличие Node.js;
   - выполнит `npm install` в папке проекта;
   - спросит, нужно ли запускать приложение при старте системы;
   - при положительном ответе создаст **systemd-**сервис `taxes-sender` (или запись в crontab @reboot, если systemd недоступен);
   - опционально откроет порт **3847** в UFW или firewalld;
   - может сразу запустить сервер.
3. Команды при установленном systemd-сервисе:
   ```bash
   sudo systemctl start taxes-sender   # запустить
   sudo systemctl stop taxes-sender     # остановить
   sudo systemctl restart taxes-sender  # перезапустить
   sudo systemctl status taxes-sender  # статус
   ```
   Логи сервиса:
   ```bash
   journalctl -u taxes-sender -f
   ```

### Удаление только автозагрузки

Код и данные не удаляются, перестаёт только автоматический запуск:

```bash
sudo bash install/linux/install.sh uninstall
```

Допустимые аргументы: `uninstall`, `remove`, `--uninstall`, `--remove`.  
При необходимости скрипт предложит удалить папку `node_modules` для экономии места; для повторного запуска потом понадобится снова выполнить `npm install`.

Полный список команд (запуск, остановка, логи) — в файле **`install/linux/COMMANDS.txt`**.

---

## Первая настройка после установки

1. Откройте в браузере адрес приложения (например, http://127.0.0.1:3847).
2. Перейдите в **«Настройки»** и укажите:
   - **ЮKassa:** Shop ID и секретный ключ.
   - **Налоговая:** логин и пароль от ЛК самозанятого.
3. Сохраните настройки.
4. При доступе из сети рекомендуется включить **«Безопасность»** (авторизацию) и сменить логин/пароль с `admin` / `admin` на свои.

После этого можно пользоваться разделами «Платежи», «Чеки», синхронизацией с налоговой и т.д.
