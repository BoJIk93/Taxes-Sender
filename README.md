# Taxes Sender

**Локальное приложение для самозанятых:** загрузка платежей из ЮKassa и отправка чеков в Федеральную налоговую службу (ЛК НПД / Мой налог).

- Работает на вашем компьютере или сервере, данные не уходят на сторонние сервера (кроме ЮKassa и ФНС).
- Веб-интерфейс: настройки, список платежей, отправка и аннулирование чеков, синхронизация с налоговой.
- Опциональная авторизация (логин/пароль) для доступа к интерфейсу.

---

## Требования

- **Node.js** 16 или выше — [скачать](https://nodejs.org/)
- Аккаунт **ЮKassa** (Shop ID и секретный ключ)
- Регистрация в **«Мой налог»** (логин/пароль от ЛК НПД)

---

## Быстрый старт

1. Скачайте или клонируйте репозиторий.
2. В корне проекта выполните:
   ```bash
   npm install
   npm start
   ```
3. Откройте в браузере: **http://127.0.0.1:3847**
4. В разделе **«Настройки»** укажите:
   - **ЮKassa:** Shop ID и секретный ключ
   - **Налоговая:** логин и пароль от личного кабинета самозанятого
5. Сохраните настройки, при необходимости включите **авторизацию** и смените логин/пароль по умолчанию (`admin` / `admin`).

Подробная установка под Windows и Linux — в [docs/INSTALL.md](docs/INSTALL.md).

---

## Установка

### Windows

- **Ручной запуск:** запустите `start.bat` или в терминале: `node server/index.js`
- **Установщик (рекомендуется):** откройте `install/windows/install.hta` — пошаговая установка (Node.js, автозапуск через службу Windows при необходимости).
- Остановка: `stop.bat` или закройте окно сервера.

### Linux

- **Ручной запуск:** из папки проекта: `node server/index.js`
- **Автозапуск при старте системы:**
  ```bash
  sudo bash install/linux/install.sh
  ```
- Удаление только автозагрузки (код и данные остаются):
  ```bash
  sudo bash install/linux/install.sh uninstall
  ```
- Все команды (запуск, остановка, логи): см. `install/linux/COMMANDS.txt`

Детали — в [docs/INSTALL.md](docs/INSTALL.md).

---

## Конфигурация и секреты

Приложение не хранит ключи в коде. Всё настраивается через веб-интерфейс и сохраняется локально.

| Данные | Где задаются | Где хранятся |
|--------|----------------|---------------|
| **ЮKassa:** Shop ID, секретный ключ | Настройки в веб-интерфейсе | Зашифрованный файл `data/config.enc` |
| **Налоговая:** логин, пароль ЛК НПД | Настройки в веб-интерфейсе | Там же |
| **Авторизация веб-интерфейса** (логин/пароль) | Настройки → Безопасность | Там же (пароль в виде хеша) |
| **Ключ шифрования конфига** | Создаётся при первом запуске | `data/.key` |

- Папка **`data/`** не должна попадать в репозиторий (уже в `.gitignore`). В ней: конфиг, ключ шифрования, БД SQLite, логи.
- По умолчанию логин/пароль входа в приложение: **admin** / **admin** — обязательно смените в настройках при доступе из сети.

Подробнее о структуре проекта, API и функциях — в [docs/CODE.md](docs/CODE.md).

---

## Структура проекта

```
taxes-sender/
├── server/                 # Сервер Node.js
│   ├── index.js            # Точка входа, порт 3847
│   └── lib/                # Модули: маршруты, БД, ЮKassa, ФНС, авторизация, конфиг
├── public/                 # Веб-интерфейс (HTML, CSS, JS)
├── data/                   # Данные (создаётся при первом запуске, в .gitignore)
│   ├── config.enc          # Зашифрованный конфиг
│   ├── .key                # Ключ шифрования
│   ├── database.sqlite     # SQLite: чеки, услуги, кэш налоговой
│   └── server.log          # Лог (если пишется в файл)
├── install/
│   ├── linux/              # Установка и автозапуск (systemd/cron)
│   └── windows/            # Установщик HTA, скрипты Node/NSSM
├── start.bat / stop.bat    # Запуск и остановка (Windows)
├── package.json
└── README.md
```

---

## Документация

- **[docs/INSTALL.md](docs/INSTALL.md)** — установка и запуск на Windows и Linux пошагово.
- **[docs/CODE.md](docs/CODE.md)** — описание файлов, модулей, API и используемых секретов.

---

## Лицензия

ISC.
